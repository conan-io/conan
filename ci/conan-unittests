FROM ubuntu:22.04

LABEL maintainer="Conan.io <info@conan.io>"

# Instalar dependencias necesarias
RUN apt-get update && apt-get install -y --no-install-recommends \
    git curl make build-essential libssl-dev zlib1g-dev \
    libbz2-dev libreadline-dev libsqlite3-dev wget llvm \
    libncurses5-dev libncursesw5-dev xz-utils tk-dev libffi-dev \
    liblzma-dev python3-openssl ca-certificates sudo tar && \
    rm -rf /var/lib/apt/lists/*

# Crear usuario 'conan'
RUN useradd -m -s /bin/bash conan && \
    echo 'conan ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers

# Configurar variables de entorno para pyenv
ENV HOME /home/conan
ENV PYENV_ROOT $HOME/.pyenv
ENV PATH $PYENV_ROOT/bin:$PYENV_ROOT/shims:$PATH

# Instalar pyenv usando el instalador oficial
RUN curl https://pyenv.run | bash

# Instalar Python y establecer versi√≥n global
RUN pyenv install 3.8.6 && pyenv global 3.8.6

# Instalar pip
RUN curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py && \
    python get-pip.py && \
    rm get-pip.py

# Cambiar propiedad al usuario 'conan'
RUN chown -R conan:conan $HOME

USER conan
WORKDIR $HOME

CMD ["/bin/bash"]
